<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mayatech Hızlı Form Sistemi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');
        :root {
            --background: #1a1b26;
            --foreground: #c0caf5;
            --green: #9ece6a;
            --red: #f7768e;
        }
        body {
            font-family: 'Fira Code', monospace;
            margin: 0;
            background-color: var(--background);
            color: var(--foreground);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 15px;
            box-sizing: border-box;
        }
        .terminal-window {
            width: 100%;
            height: 100%;
            max-width: 900px;
            max-height: 600px;
            background: var(--background);
            border: 1px solid #414868;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .terminal-output {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            line-height: 1.5;
        }
        .terminal-output div {
            white-space: pre-wrap;
            word-break: break-all;
        }
        .prompt-line {
            display: flex;
            align-items: center;
            padding: 0 20px 20px;
        }
        .prompt-label {
            color: var(--green);
            font-weight: 500;
        }
        .terminal-input {
            flex-grow: 1;
            background: transparent;
            border: none;
            color: var(--foreground);
            font-family: inherit;
            font-size: 1em;
            outline: none;
            padding-left: 10px;
        }
        .cursor {
            display: inline-block;
            background-color: var(--foreground);
            width: 10px;
            height: 1.2em;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { background-color: transparent; }
            50% { background-color: var(--foreground); }
        }
        .file-list-item { margin-left: 20px; }
        .success { color: var(--green); }
        .error { color: var(--red); }
    </style>
</head>
<body>
    <div class="terminal-window" id="terminal-window">
        <div class="terminal-output" id="terminal-output"></div>
        <div class="prompt-line">
            <span class="prompt-label" id="prompt-label">password:</span>
            <input type="password" class="terminal-input" id="terminal-input" autocomplete="off" autofocus>
            <span class="cursor"></span>
        </div>
    </div>

    <script>
        const output = document.getElementById('terminal-output');
        const input = document.getElementById('terminal-input');
        const promptLabel = document.getElementById('prompt-label');
        const terminalWindow = document.getElementById('terminal-window');

        let isLoggedIn = false;
        let fileCache = [];
        const commandHistory = [];
        let historyIndex = -1;

        const print = (text, className = '') => {
            const line = document.createElement('div');
            line.className = className;
            line.innerHTML = text; // innerHTML for color tags
            output.appendChild(line);
            terminalWindow.scrollTop = terminalWindow.scrollHeight;
            output.scrollTop = output.scrollHeight;
        };
        
        const printWelcome = () => {
            print('Mayatech Hızlı Form Sistemi [Versiyon 2.0]');
            print('(c) Mayatech. Tüm hakları saklıdır.');
            print('<br>');
            print('Giriş yapmak için parolanızı girin.');
        };

        const handleCommand = async (command) => {
            print(`<span style="color: var(--green);">${promptLabel.textContent}</span> ${command}`);
            if (!isLoggedIn) {
                try {
                    const response = await fetch('/api/getFiles', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password: command }) });
                    if (response.ok) {
                        isLoggedIn = true;
                        fileCache = await response.json();
                        input.type = 'text';
                        promptLabel.textContent = 'mayatech@sistem:~$';
                        print('<br><span class="success">Erişim Onaylandı. Sisteme hoş geldiniz.</span>');
                        print('Kullanılabilir komutları görmek için `help` yazın.');
                    } else {
                        print('<span class="error">Erişim Reddedildi.</span>');
                    }
                } catch (error) {
                    print('<span class="error">Sunucuya bağlanılamadı.</span>');
                }
                return;
            }

            const [cmd, ...args] = command.trim().split(' ');
            switch (cmd.toLowerCase()) {
                case 'help':
                    print(`
<b>Kullanılabilir Komutlar:</b>
  <b>ls</b>             - Tüm dosyaları listeler.
  <b>edit [numara]</b>  - Belirtilen numaradaki dosyayı düzenlemek için açar.
  <b>clear</b>          - Ekranı temizler.
  <b>help</b>           - Bu yardım menüsünü gösterir.
                    `);
                    break;
                case 'ls':
                    if (fileCache.length > 0) {
                        let fileListHtml = '<b>Dosyalar:</b><br>';
                        fileCache.forEach((file, index) => {
                            fileListHtml += `<div class="file-list-item">[${index + 1}] ${file.name}</div>`;
                        });
                        print(fileListHtml);
                    } else {
                        print('Listelenecek dosya bulunamadı.');
                    }
                    break;
                case 'edit':
                    const fileNumber = parseInt(args[0], 10);
                    if (isNaN(fileNumber) || fileNumber < 1 || fileNumber > fileCache.length) {
                        print(`<span class="error">Hata: Geçersiz dosya numarası. 'ls' komutu ile listeyi kontrol edin.</span>`);
                    } else {
                        const file = fileCache[fileNumber - 1];
                        print(`'${file.name}' dosyası yeni sekmede açılıyor...`);
                        window.open(file.url, '_blank');
                    }
                    break;
                case 'clear':
                    output.innerHTML = '';
                    break;
                case '':
                    break;
                default:
                    print(`<span class="error">Komut bulunamadı: ${command}</span>`);
            }
        };

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const command = input.value;
                handleCommand(command);
                if (command) {
                    commandHistory.unshift(command);
                    historyIndex = -1;
                }
                input.value = '';
            } else if (e.key === 'ArrowUp') {
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    input.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                if (historyIndex > 0) {
                    historyIndex--;
                    input.value = commandHistory[historyIndex];
                } else {
                    historyIndex = -1;
                    input.value = '';
                }
            }
        });

        terminalWindow.addEventListener('click', () => input.focus());
        printWelcome();

    </script>
</body>
</html>

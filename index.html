<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mayatech Hızlı Dosya Sistemi</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary-accent:#f37f21;
  --light-accent:#fed7aa;
  --background:#f9fafb;
  --card-bg:#ffffff;
  --text-dark:#231f20;
  --text-light:#6b7280;
  --border-color:#e5e7eb;
  --sidebar-width:260px;
  --radius:12px;
  --glass: rgba(255,255,255,0.6);
}
body.dark-theme{
  --light-accent:#523013;
  --background:#111827;
  --card-bg:#1f2937;
  --text-dark:#f9fafb;
  --text-light:#9ca3af;
  --border-color:#374151;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background:linear-gradient(135deg,#fff7ed,#fff1e5);
  color:var(--text-dark);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  -webkit-tap-highlight-color:transparent;
}

/* Wrapper */
.app-wrapper{
  width:100%;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:0;
}

/* Login screen */
#login-screen{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:var(--background);
  z-index:300;
  transition:opacity .45s ease,transform .45s ease;
}
#login-screen.hidden{opacity:0;transform:scale(.98);pointer-events:none}
.login-box{ text-align:center; padding:0 1rem }
.login-logo{ max-width:140px; height:auto; margin-bottom:1.5rem }
.input-group{ display:flex; flex-direction:column; gap:1rem; width:100%; max-width:320px }
.input-group input{
  padding:14px; border-radius:12px; border:1px solid var(--border-color);
  background:var(--card-bg); color:var(--text-dark); font-size:1rem; text-align:center;
}
.login-button{
  background:var(--primary-accent); color:#fff; border:none; padding:12px 14px; border-radius:12px;
  font-weight:600; cursor:pointer;
}
.login-button[disabled]{opacity:.6;cursor:not-allowed}
#login-error-message{ color:#ef4444; margin-top:8px; display:none }

/* App container */
#app-container{
  width:100%;
  max-width:1200px;
  height:calc(100vh - 32px);
  display:none;
  background:var(--card-bg);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 20px 40px rgba(0,0,0,0.08);
  opacity:0; transform:translateY(18px); transition:opacity .45s ease, transform .45s ease;
}
#app-container.visible{opacity:1; transform:translateY(0)}

/* Sidebar */
.sidebar{
  width:var(--sidebar-width);
  height:100%;
  padding:20px;
  background:var(--background);
  border-right:1px solid var(--border-color);
  display:flex;
  flex-direction:column;
  gap:12px;
  z-index:210;
}
.sidebar-header{ margin-bottom:8px }
.header-logo{ max-height:40px; cursor:pointer }
.nav-list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; flex:1 }
.nav-item button{
  display:flex; align-items:center; gap:12px;
  padding:12px; border-radius:10px; border:none; background:none; cursor:pointer;
  color:var(--text-light); font-weight:600; text-align:left;
}
.nav-item button:hover{ background:var(--light-accent); color:var(--primary-accent) }
.sidebar-footer{ margin-top:auto; padding-top:8px; border-top:1px solid var(--border-color) }
.version-info{ font-size:12px; color:var(--text-light); cursor:pointer; user-select:none }
.version-info .long-version{ display:none }
.version-info.expanded .short-version{ display:none }
.version-info.expanded .long-version{ display:inline }

/* Main content */
.main-content{ display:flex; flex-direction:column; height:100% }
.main-header{
  padding:14px 18px; display:flex; align-items:center; justify-content:space-between; gap:12px;
  border-bottom:1px solid var(--border-color);
}
.hamburger-button{
  display:none; background:none;border:none;padding:6px; cursor:pointer;
}
.header-logo-main{ max-height:34px; }
/* content */
.content-area{ padding:18px; flex:1; overflow:auto; background:transparent }
#welcome-view{ display:flex; align-items:center; justify-content:center; height:100%; color:var(--text-light); font-size:1.15rem }
#file-view{ display:none }

/* File list */
.file-list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:12px }
.file-item{
  display:flex; flex-direction:column; gap:8px; background:var(--card-bg); border-radius:12px;
  border:1px solid var(--border-color); padding:12px; box-shadow:0 4px 10px rgba(0,0,0,0.03);
  transition:transform .18s ease,box-shadow .18s ease;
}
.file-row{ display:flex; align-items:center; gap:12px; width:100%; }
.file-row:hover{ transform:translateY(-2px); box-shadow:0 8px 20px rgba(0,0,0,0.05) }
.file-icon{
  width:44px;height:44px;border-radius:10px; display:flex; align-items:center; justify-content:center;
  background:var(--light-accent); color:var(--primary-accent); flex-shrink:0;
}
.file-details{ flex:1; display:flex; flex-direction:column; gap:2px }
.file-name{ font-weight:600; color:var(--text-dark) }
.file-meta{ font-size:13px; color:var(--text-light) }
.controls{ display:flex; gap:8px; align-items:center }
.edit-button{
  border:none; padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer;
  background:var(--light-accent); color:var(--primary-accent);
}
.edit-button:hover{ background:#fdbf80 }

/* Expandable description */
.file-desc{
  max-height:0; overflow:hidden; transition: max-height .28s ease, padding .28s ease;
  padding:0 4px; color:var(--text-light);
  font-size:14px; border-top:1px dashed var(--border-color);
}
.file-desc.open{ padding:10px 4px; max-height:160px }

/* Overlay for mobile sidebar */
#sidebar-overlay{
  position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:205; opacity:0; pointer-events:none; transition:opacity .25s ease;
}
body.sidebar-open #sidebar-overlay{ opacity:1; pointer-events:auto }
body.sidebar-open{ overflow:hidden }

/* Responsive behavior */
@media(min-width:800px){
  .app-layout{ display:grid; grid-template-columns:var(--sidebar-width) 1fr; height:100% }
  #app-container{ max-width:1100px }
  .hamburger-button{ display:none }
}
@media(max-width:799px){
  .app-layout{ display:flex; flex-direction:column; height:100% }
  #app-container{ width:100%; height:calc(100vh - 24px); border-radius:12px; }
  .sidebar{ position:fixed; left:0; top:0; bottom:0; transform:translateX(-100%); transition:transform .28s ease; box-shadow:0 18px 40px rgba(0,0,0,0.12) }
  body.sidebar-open .sidebar{ transform:translateX(0) }
  .hamburger-button{ display:inline-flex }
  .version-info{ position:fixed; left:12px; bottom:12px; background:var(--glass); padding:6px 8px; border-radius:8px }
}

/* Dark background wrapper tweak */
body.dark-theme .app-wrapper{ background:linear-gradient(135deg,#1e293b,#0f172a) }

/* small helpers */
.hidden{ display:none!important }
.center{ display:flex; align-items:center; justify-content:center }
</style>
</head>
<body>

<div class="app-wrapper">
  <div id="login-screen" aria-hidden="false">
    <button id="theme-toggle-login" class="theme-toggle-button" title="Temayı Değiştir" aria-label="Tema"></button>
    <div class="login-box" role="dialog" aria-label="Giriş">
      <img src="logo.png" alt="Mayatech Logo" class="login-logo">
      <p style="color:var(--text-light); margin-bottom:1rem">Devam etmek için lütfen parolanızı girin.</p>
      <div class="input-group">
        <input id="password" type="password" placeholder="Parola" aria-label="Parola">
        <button id="login-button" class="login-button">Giriş Yap</button>
      </div>
      <p id="login-error-message">Hatalı parola.</p>
    </div>
    <footer class="app-footer login-footer" style="position:relative; top:18px;">MHDS - Mayatech Bilgi İşlem 2025©</footer>
  </div>

  <div id="app-container" role="application" aria-hidden="true">
    <div class="app-layout" style="height:100%">
      <nav class="sidebar" id="sidebar" aria-label="Yan Menü">
        <div class="sidebar-header">
          <img src="logo.png" alt="MHDS Logo" class="header-logo" id="home-logo-sidebar">
        </div>
        <ul class="nav-list" role="menu">
          <li class="nav-item" role="none">
            <button id="show-files-button" role="menuitem" aria-haspopup="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><use href="#icon-folder"></use></svg>
              Formlar
            </button>
          </li>
        </ul>

        <div class="sidebar-footer">
          <div class="version-info" id="version-info" role="button" tabindex="0">
            <span class="short-version">v.25.0</span>
            <span class="long-version">v.25.0 - Yeni altyapı & menü sistemi</span>
          </div>
        </div>
      </nav>

      <main class="main-content" aria-live="polite">
        <header class="main-header">
          <div style="display:flex;align-items:center;gap:12px">
            <button id="hamburger-button" class="hamburger-button" aria-label="Menüyü Aç/Kapat">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
            <img src="logo.png" alt="MHDS Logo" class="header-logo-main" id="home-logo-main">
          </div>

          <div style="display:flex;align-items:center;gap:12px">
            <button id="theme-toggle-main" class="theme-toggle-button" title="Temayı Değiştir" aria-label="Tema"></button>
          </div>
        </header>

        <div class="content-area">
          <div id="welcome-view">
            <p>Erişmek istediğiniz klasörü seçin.</p>
          </div>

          <div id="file-view" aria-hidden="true">
            <ul class="file-list" id="file-list"></ul>
          </div>
        </div>

        <footer class="app-footer main-footer">MHDS - Mayatech Bilgi İşlem 2025©</footer>
      </main>
    </div>
  </div>

  <div id="sidebar-overlay" aria-hidden="true"></div>
</div>

<!-- SVG icons kept -->
<svg width="0" height="0" style="position:absolute;">
  <defs>
    <symbol id="icon-file" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></symbol>
    <symbol id="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></symbol>
    <symbol id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></symbol>
    <symbol id="icon-folder" viewBox="0 0 24 24" stroke="currentColor" fill="none"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></symbol>
  </defs>
</svg>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Elements
  const loginScreen = document.getElementById('login-screen');
  const appContainer = document.getElementById('app-container');
  const passwordInput = document.getElementById('password');
  const loginButton = document.getElementById('login-button');
  const loginErrorMessage = document.getElementById('login-error-message');
  const fileList = document.getElementById('file-list');
  const themeToggleLogin = document.getElementById('theme-toggle-login');
  const themeToggleMain = document.getElementById('theme-toggle-main');
  const showFilesButton = document.getElementById('show-files-button');
  const hamburgerButton = document.getElementById('hamburger-button');
  const sidebarOverlay = document.getElementById('sidebar-overlay');
  const welcomeView = document.getElementById('welcome-view');
  const fileView = document.getElementById('file-view');
  const versionInfo = document.getElementById('version-info');
  const homeLogoSidebar = document.getElementById('home-logo-sidebar');
  const homeLogoMain = document.getElementById('home-logo-main');
  const sidebar = document.getElementById('sidebar');

  // Icons
  const sunIcon = '<svg width="18" height="18" viewBox="0 0 24 24"><use href="#icon-sun"></use></svg>';
  const moonIcon = '<svg width="18" height="18" viewBox="0 0 24 24"><use href="#icon-moon"></use></svg>';

  // Theme
  function applyTheme(theme){
    if(theme === 'dark'){
      document.body.classList.add('dark-theme');
      themeToggleLogin.innerHTML = sunIcon;
      themeToggleMain.innerHTML = sunIcon;
    } else {
      document.body.classList.remove('dark-theme');
      themeToggleLogin.innerHTML = moonIcon;
      themeToggleMain.innerHTML = moonIcon;
    }
  }
  (function initTheme(){
    const saved = localStorage.getItem('theme');
    applyTheme(saved || 'dark');
  })();
  function toggleTheme(){
    const isDark = document.body.classList.contains('dark-theme');
    const newTheme = isDark ? 'light' : 'dark';
    localStorage.setItem('theme', newTheme);
    applyTheme(newTheme);
  }
  themeToggleLogin.addEventListener('click', toggleTheme);
  themeToggleMain.addEventListener('click', toggleTheme);

  // Sidebar control
  function openSidebar(){ document.body.classList.add('sidebar-open'); sidebarOverlay.setAttribute('aria-hidden','false'); sidebar.setAttribute('aria-hidden','false'); }
  function closeSidebar(){ document.body.classList.remove('sidebar-open'); sidebarOverlay.setAttribute('aria-hidden','true'); sidebar.setAttribute('aria-hidden','true'); }
  hamburgerButton.addEventListener('click', (e) => { e.stopPropagation(); openSidebar(); });
  sidebarOverlay.addEventListener('click', closeSidebar);

  // Navigation
  function goHome(){
    welcomeView.style.display = 'flex';
    fileView.style.display = 'none';
    closeSidebar();
  }
  // When clicking nav button: stop propagation so overlay/other handlers don't immediately close sidebar.
  showFilesButton.addEventListener('click', (e) => {
    e.stopPropagation();
    welcomeView.style.display = 'none';
    fileView.style.display = 'block';
    // Close sidebar after a small delay so the button click finishes on touch devices (prevents lost clicks).
    setTimeout(()=> closeSidebar(), 180);
  });
  homeLogoSidebar.addEventListener('click', (e)=>{ e.stopPropagation(); goHome(); });
  homeLogoMain.addEventListener('click', goHome);

  // Version toggle
  versionInfo.addEventListener('click', ()=> versionInfo.classList.toggle('expanded'));
  versionInfo.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') versionInfo.classList.toggle('expanded'); });

  // File rendering and interactions
  function createFileListItem(file, index){
    const li = document.createElement('li');
    li.className = 'file-item';
    li.style.animationDelay = `${index*80}ms`;

    // Row (clickable to toggle description)
    const row = document.createElement('div');
    row.className = 'file-row';

    const icon = document.createElement('div');
    icon.className = 'file-icon';
    icon.innerHTML = '<svg width="18" height="18"><use href="#icon-file"></use></svg>';

    const details = document.createElement('div');
    details.className = 'file-details';
    const name = document.createElement('div');
    name.className = 'file-name';
    name.textContent = file.name || 'İsimsiz dosya';
    const meta = document.createElement('div');
    meta.className = 'file-meta';
    // show minimal meta if available
    const metaParts = [];
    if(file.size) metaParts.push(file.size);
    if(file.modified) metaParts.push(file.modified);
    meta.textContent = metaParts.join(' • ') || '';

    details.appendChild(name);
    details.appendChild(meta);

    const controls = document.createElement('div');
    controls.className = 'controls';
    const editLink = document.createElement('a');
    // encode file name in query param
    const editHref = '/editFile?name=' + encodeURIComponent(file.name || '');
    editLink.href = editHref;
    editLink.setAttribute('aria-label', `Düzenle ${file.name || ''}`);
    const editBtn = document.createElement('button');
    editBtn.className = 'edit-button';
    editBtn.type = 'button';
    editBtn.textContent = 'Düzenle';
    // ensure clicking edit does not toggle the row
    editBtn.addEventListener('click', (ev) => { ev.stopPropagation(); /* link will navigate */ });
    editLink.appendChild(editBtn);
    controls.appendChild(editLink);

    row.appendChild(icon);
    row.appendChild(details);
    row.appendChild(controls);

    // Description block (collapsible)
    const desc = document.createElement('div');
    desc.className = 'file-desc';
    // Simple short description: use file.description or fallback message
    desc.textContent = file.description || `Bu dosya son olarak ${file.modified || 'bilinmeyen bir tarihte'} güncellendi.`;

    // Toggle on row click (but not when clicking controls)
    row.addEventListener('click', (ev) => {
      ev.stopPropagation();
      const wasOpen = desc.classList.contains('open');
      // close any other open descriptions (keeps UI tidy)
      document.querySelectorAll('.file-desc.open').forEach(d => {
        if(d !== desc) d.classList.remove('open');
      });
      if(!wasOpen){
        desc.classList.add('open');
      } else {
        desc.classList.remove('open');
      }
    });

    li.appendChild(row);
    li.appendChild(desc);
    return li;
  }

  function displayFiles(files){
    fileList.innerHTML = '';
    if(!Array.isArray(files) || files.length === 0){
      fileList.innerHTML = '<li style="color:var(--text-light)">Görüntülenecek dosya yok.</li>';
      return;
    }
    files.forEach((f,i) => fileList.appendChild(createFileListItem(f,i)));
  }

  // Show app UI after login
  function showApp(files){
    displayFiles(files);
    loginScreen.classList.add('hidden');
    setTimeout(()=> {
      appContainer.style.display = window.innerWidth >= 800 ? 'grid' : 'block';
      appContainer.setAttribute('aria-hidden','false');
      setTimeout(()=> appContainer.classList.add('visible'), 40);
    }, 420);
  }

  // Login flow (kept same endpoint)
  async function handleLogin(){
    const password = passwordInput.value;
    if(!password){ loginErrorMessage.style.display = 'block'; return; }
    loginButton.disabled = true;
    loginButton.textContent = 'Doğrulanıyor...';
    loginErrorMessage.style.display = 'none';
    try{
      const res = await fetch('/api/getFiles', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ password })
      });
      if(res.ok){
        const files = await res.json();
        sessionStorage.setItem('isLoggedIn','true');
        sessionStorage.setItem('fileCache', JSON.stringify(files));
        showApp(files);
      } else {
        loginErrorMessage.style.display = 'block';
        passwordInput.value = '';
      }
    } catch(err){
      loginErrorMessage.textContent = 'Bir ağ hatası oluştu. Lütfen tekrar deneyin.';
      loginErrorMessage.style.display = 'block';
    } finally {
      loginButton.disabled = false;
      loginButton.textContent = 'Giriş Yap';
    }
  }

  loginButton.addEventListener('click', handleLogin);
  passwordInput.addEventListener('keyup', (e) => { if(e.key === 'Enter') handleLogin(); });

  // Restore session if exists
  (function restore(){
    applyTheme(localStorage.getItem('theme') || 'dark');
    if(sessionStorage.getItem('isLoggedIn') === 'true'){
      try{
        const cached = JSON.parse(sessionStorage.getItem('fileCache') || '[]');
        if(Array.isArray(cached) && cached.length) showApp(cached);
      }catch(e){ /* ignore */ }
    }
  })();

  // Close open desc when clicking outside
  document.addEventListener('click', (e) => {
    // if click outside sidebar while open, close
    if(document.body.classList.contains('sidebar-open')){
      const insideSidebar = e.composedPath().includes(sidebar);
      const insideHamburger = e.composedPath().includes(hamburgerButton);
      if(!insideSidebar && !insideHamburger) closeSidebar();
    }
    // close open file-desc if clicked outside any file-item
    const clickedInFile = e.target.closest('.file-item');
    if(!clickedInFile){
      document.querySelectorAll('.file-desc.open').forEach(d => d.classList.remove('open'));
    }
  });

  // Accessibility: escape closes sidebar and open descs
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape'){
      closeSidebar();
      document.querySelectorAll('.file-desc.open').forEach(d => d.classList.remove('open'));
    }
  });

});
</script>
</body>
</html>
